// components/CustomButton.tsx
'use client'
import React, { useState, useEffect } from 'react'

export function ButtonGroup({
  cols = 3,
  gap = 1,
  children,
}: {
  cols?: number
  gap?: number
  children: React.ReactNode
}) {
  const [colsCount, setColsCount] = useState(cols)

  useEffect(() => {
    const updateCols = () => {
      const w = window.innerWidth
      if (w < 640) {
        setColsCount(1)
      } else if (w < 768) {
        setColsCount(Math.min(cols, 2))
      } else {
        setColsCount(cols)
      }
    }
    updateCols()
    window.addEventListener('resize', updateCols)
    return () => window.removeEventListener('resize', updateCols)
  }, [cols])

  return (
    <div
      style={{
        display: 'grid',
        gridTemplateColumns: `repeat(${colsCount}, minmax(0, 1fr))`,
        gap: `${gap}rem`,
      }}
    >
      {children}
    </div>
  )
}

export function IconButton({
  icon,
  text,
  href,
  newTab = false,
  size = 'md',
}: {
  icon: string
  text: string
  href: string
  newTab?: boolean
  size?: 'sm' | 'md' | 'lg'
}) {
  const [isDark, setIsDark] = useState(false)

  useEffect(() => {
    const html = document.documentElement
    const update = () => setIsDark(html.classList.contains('dark'))
    update()
    const mo = new MutationObserver(update)
    mo.observe(html, { attributes: true, attributeFilter: ['class'] })
    return () => mo.disconnect()
  }, [])

  const bg          = isDark ? '#0e0e0f' : '#ffffff'
  const lightBorder = '#D1D5DB'
  const lightHover  = '#4B5563'
  const darkBorder  = 'rgba(255, 236, 209,0.1)'
  const darkHover   = 'rgba(255, 236, 209,1)'
  const lightArrow  = '#6B7280'
  const darkArrow   = 'rgba(255, 236, 209,0.4)'

  const borderColor = isDark ? darkBorder : lightBorder
  const hoverColor  = isDark ? darkHover  : lightHover
  const arrowColor  = isDark ? darkArrow  : lightArrow

  const sizeClasses =
    size === 'sm'
      ? 'px-4 py-3 text-sm'
      : size === 'lg'
      ? 'px-8 py-7 text-lg'
      : 'px-6 py-5 text-base'

  return (
    <>
      <a
        href={href}
        target={newTab ? '_blank' : '_self'}
        rel={newTab ? 'noopener noreferrer' : undefined}
        className={`${sizeClasses} icon-btn relative flex items-center gap-x-3 w-full text-[var(--color-text)] rounded-xl not-prose group`}
        style={{ backgroundColor: bg }}
      >
        <div className="absolute top-5 right-5">
          <svg
            className="w-4 h-4 arrow-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
          >
            <path d="M7 7h10v10" />
            <path d="M7 17L17 7" />
          </svg>
        </div>

        <div className="h-6 w-6">
          <img
            src={icon}
            alt=""
            className="h-full w-full object-contain"
            style={{ filter: 'var(--color-filter)', color: 'var(--color-text)' }}
          />
        </div>

        <span className="not-prose font-semibold text-base">{text}</span>
      </a>

      <style jsx>{`
        .icon-btn {
          --btn-border: ${borderColor};
          --arrow-stroke: ${arrowColor};
          border: 1px solid var(--btn-border);
          transition: border-color 150ms ease-in-out;
        }
        .icon-btn:hover {
          --btn-border: ${hoverColor};
          --arrow-stroke: ${hoverColor};
        }
        .icon-btn .arrow-icon {
          stroke: var(--arrow-stroke);
          stroke-width: 2;
          stroke-linecap: round;
          stroke-linejoin: round;
          transition: stroke 150ms ease-in-out;
        }
      `}</style>
    </>
  )
}
